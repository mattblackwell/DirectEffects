<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Perform telescope matching to estimate the controlled
direct effect of a binary treatment net the effect of binary
mediators"><title>Perform telescope matching to estimate the controlled
direct effect of a binary treatment net the effect of binary
mediators — telescope_match • DirectEffects</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Perform telescope matching to estimate the controlled
direct effect of a binary treatment net the effect of binary
mediators — telescope_match"><meta property="og:description" content="Perform telescope matching to estimate the controlled
direct effect of a binary treatment net the effect of binary
mediators"><meta property="og:image" content="https://mattblackwell.github.io/DirectEffects/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DirectEffects</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/DirectEffects.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/telescope_matching.html">Telescope matching</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mattblackwell/DirectEffects/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Perform telescope matching to estimate the controlled
direct effect of a binary treatment net the effect of binary
mediators</h1>
      <small class="dont-index">Source: <a href="https://github.com/mattblackwell/DirectEffects/blob/HEAD/R/telescope_match.R" class="external-link"><code>R/telescope_match.R</code></a></small>
      <div class="d-none name"><code>telescope_match.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Perform telescope matching to estimate the controlled
direct effect of a binary treatment net the effect of binary
mediators</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">telescope_match</span><span class="op">(</span>
  <span class="va">formula</span>,
  <span class="va">data</span>,
  caliper <span class="op">=</span> <span class="cn">NULL</span>,
  L <span class="op">=</span> <span class="fl">5</span>,
  verbose <span class="op">=</span> <span class="cn">TRUE</span>,
  <span class="va">subset</span>,
  contrasts <span class="op">=</span> <span class="cn">NULL</span>,
  separate_bc <span class="op">=</span> <span class="cn">TRUE</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>formula</dt>
<dd><p>A formula object that specifies the covariates and
treatment variables (or mediators) in causal ordering from oldest
to newest with each group separated by <code>|</code>. See below for
  more details.</p></dd>
<dt>data</dt>
<dd><p>A dataframe containing variables referenced by
<code>formula</code>.</p></dd>
<dt>caliper</dt>
<dd><p>A scalar denoting the caliper to be used in matching
in the treatment stage (calipers cannot be used for matching on
the mediator). Observations outside of the caliper are dropped.
Calipers are specified in standard deviations of the covariates.
NULL by default (no caliper).</p></dd>
<dt>L</dt>
<dd><p>Number of matches to use for each unit. Must be a numeric
vector of eitehr length 1 or 2. If length 1, L sets the number of
matches used in both the first stage (matching on mediator) and
in the second stage (matching on treatment). If length 2, the
first element sets the number of matches used in the first stage
(matching on mediator) and the second element sets the number of
matches used in the second stage (matching on treatment) Default
is 5.</p></dd>
<dt>verbose</dt>
<dd><p>logical indicating whether to display progress
information. Default is <code>TRUE</code>.</p></dd>
<dt>subset</dt>
<dd><p>A vector of logicals indicating which rows of
<code>data</code> to keep.</p></dd>
<dt>contrasts</dt>
<dd><p>a list to be passed to the <code>contrasts.arg</code>
argument of <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix()</a></code> when generating the data matrix.</p></dd>
<dt>separate_bc</dt>
<dd><p>logical indicating whether or not bias
correction regressions should be run separately within levels of
the treatment and mediator. Defaults to <code>TRUE</code>. If
<code>TRUE</code>, any interactions between treatment/mediator and
covariates in the specification should be omitted.</p></dd>
<dt>...</dt>
<dd><p>additional arguments to be passed to the low level
    regression fitting functions (see below).</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns an object of <code>class</code><code>tmatch</code>. Contains
the following components</p><ul><li><p><code>call</code>: the matched call.</p></li>
<li><p><code>formula</code>: formula used to fit the model.</p></li>
<li><p><code>m_out</code>: list of matching soluations at each time
    point. Each member of the list has a `matches` list giving the
    units matched to that unit, a `donors` list with the units to
    which the unit is matched, and a `tr` vector which is just the
    treatment vector being matched.</p></li>
<li><p><code>K</code>: data.frame of indicating how many times a unit
    has been used as a match, directly in each period and indirectly
    across periods.</p></li>
<li><p><code>L</code>: vector of matching ratios used in each period.</p></li>
<li><p><code>r_out</code>: nested list of regression imputations used in the
    bias correction. The first level of the list varies across
    different controlled direct effects (different sequences of future
    treatments/mediators). Each of these is a list of time periods and
    each of these time periods is a list of `yhat_r_0` and `yhat_r_1`
    that give the regression predictions for the potential outcomes at
    that time point when the treatment at that time point is 0 or 1,
    respectively, along with `n_coefs` giving the number of
    coefficients estimated in those models.</p></li>
<li><p><code>tau</code>: vector of bias-corrected estimates of average
    controlled direct effects for different vectors of future
    treatments/mediators.</p></li>
<li><p><code>tau_raw</code>: vector of standard matching estimates of average
    controlled direct effects for different vectors of future
    treatments/mediators without using bias correction.</p></li>
<li><p><code>tau_se</code>: vector of estimated standard errors for the average
    controlled direct effects estimates for different vectors of future
    treatments/mediators.</p></li>
<li><p><code>tau_i</code>: matrix of individuals contributions to the ACDE
    estimates (units on rows, different ACDEs on columns). Used for
    weighted bootstrap.</p></li>
<li><p><code>included</code>: logical vector indicating if each row of
    <code>data</code> was included in estimating <code>tau</code>.</p></li>
<li><p><code>effects</code>: data frame where each row describes the
    different ACDEs in <code>tau</code>. The <code>active</code> column describes
    the which variable's direct effect is being assessed and the rest
    of the columns describe the fixed values of the future
    treatments/mediators for that ACDE.</p></li>
<li><p><code>a_names</code>: character vector with the names of the
    treatment/mediator variables used in estimation.</p></li>
<li><p><code>caliper</code>: caliper (if any) used in matching to drop
    distant observations.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>telescope_match</code> function implements the
  two-stage "telescope matching" procedure developed by Blackwell
  and Strezhnev (2021).</p>
<p>The procedure first estimates a demediated outcome using a
 combination of matching and a regression bias-correction. The
 <code>data.frame</code> passed to <code>data</code> should be in the wide
 format so that each row corresponds to a single unit and
 treatments and covariates from different time periods appear as
 different columns. The <code>formula</code> arugment specifies both the
 causal ordering of the variables and the regression specifications
 for the bias correction. It should be of the form <code>Y ~ X1 |
 A1 | X2 | A2</code>, where <code>Y</code> is the outcome, <code>X1</code> is a
 formula of baseline covariates, <code>A1</code> is a single variable
 name indicating the binary treatment in the first period,
 <code>X2</code> is a formula of covariates in period 2, and <code>A2</code> is
 a single variable name indicating treatment in period 2 (which is
 also sometimes called the mediator). Note that it is possible to
 add more covariate/treatment pairs for additional time periods.</p>
<p>Under the default <code>separate_bc == TRUE</code>, the function will
match for each treatment/mediator based on the the covariates up to
that point within levels of past treatments (so for <code>A2</code> this
matching finds units with similar values of <code>X1</code> and <code>X2</code>
and the same value of <code>A1</code>). Once this matching is complete,
the function moves backward through treatments and imputes
potential outcomes using matches and bias-correction regressions,
which regress the current imputed potential outcome on the past
covariates, within levels of the treatment history up to the
current period. The functional form comes from the specification in
<code>formula</code>. Controlled direct effects of <code>A1</code> are
estimated for every possible combination of future treatments.</p>
<p>When <code>separate_bc</code> is <code>FALSE</code>, the bias correction
regressions are not broken out by the treatments/mediators and
those variables are simply included as separate regressors as
specified in <code>formula</code>. In this setting, interactions between
the treatment/mediator and covariates can be added on a selective
basis to the covariate block (<code>X1</code> or <code>X2</code> and so on)
specifications.</p>
<p>Matching is performed using the <code>Match()</code> routine from the
<code>Matching</code> package. By default, matching is L-to-1 nearest
neighbor with replacement using Mahalanobis distance.</p>

<p>See the references below for more details.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Blackwell, Matthew, and Strezhnev, Anton (2020)
"Telescope Matching: Reducing Model Dependence
in the Estimation of Direct Effects." Journal of the Royal
Statistical Society (Series A). doi: <a href="https://doi.org/10.1111/rssa.12759" class="external-link">10.1111/rssa.12759</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">jobcorps</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Split male/female</span></span>
<span class="r-in"><span class="va">jobcorps_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">jobcorps</span>, <span class="va">female</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Telescope matching formula - First stage (X and Z)</span></span>
<span class="r-in"><span class="va">tm_form</span> <span class="op">&lt;-</span> <span class="va">exhealth30</span> <span class="op">~</span>  <span class="va">schobef</span> <span class="op">+</span> <span class="va">trainyrbef</span> <span class="op">+</span> <span class="va">jobeverbef</span>  <span class="op">|</span></span>
<span class="r-in"><span class="va">treat</span> <span class="op">|</span> <span class="va">emplq4</span> <span class="op">+</span> <span class="va">emplq4full</span> <span class="op">|</span> <span class="va">work2year2q</span></span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">### Estimate ACDE for women holding employment at 0</span></span>
<span class="r-in"><span class="va">tm_out</span> <span class="op">&lt;-</span>  <span class="fu">telescope_match</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">tm_form</span>,</span>
<span class="r-in">  data <span class="op">=</span> <span class="va">jobcorps_female</span>,</span>
<span class="r-in">  L <span class="op">=</span> <span class="fl">3</span>,</span>
<span class="r-in">  boot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span class="r-in">  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Beginning matching...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Matching work2year2q...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Matching treat...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Beginning bias correction...</span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Matthew Blackwell, Avidit Acharya, Maya Sen, Shiro Kuriwaki, Jacob Brown, Anton Strezhnev.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer></div>

  

  

  </body></html>


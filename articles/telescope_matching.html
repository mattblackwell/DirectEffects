<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Telescope matching ‚Ä¢ DirectEffects</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Telescope matching">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DirectEffects</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/DirectEffects.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/assembly_line.html">Assmebly Line</a></li>
    <li><a class="dropdown-item" href="../articles/telescope_matching.html">Telescope matching</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mattblackwell/DirectEffects/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Telescope matching</h1>
            
            <h4 data-toc-skip class="date">2024-09-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mattblackwell/DirectEffects/blob/master/vignettes/articles/telescope_matching.Rmd" class="external-link"><code>vignettes/articles/telescope_matching.Rmd</code></a></small>
      <div class="d-none name"><code>telescope_matching.Rmd</code></div>
    </div>

    
    
<p>This vignette illustrates the telescope matching method developed in
<span class="citation">Blackwell and Strezhnev (<a href="#ref-BlaStr21">2021</a>)</span> as implemented in the
<code>telescope_matching</code> routine. One drawback of sequential
g-estimation or other model-based estimators is that they depend on
correctly specifying two regression models: one for the effect of the
mediator given treatment and pre-/post-treatment covariates and another
for the effect of treatment given pre-treatment covariates. Telescope
matching provides a more flexible and less model-dependent estimation
strategy for controlled direct effects when the treatment and mediator
are binary. It combines a two-stage matching procedure to impute the
unobserved counterfactuals with a bias-correction to account for biases
induced by imperfect matches.</p>
<div class="section level2">
<h2 id="estimation-by-telescope-matching">Estimation by telescope matching<a class="anchor" aria-label="anchor" href="#estimation-by-telescope-matching"></a>
</h2>
<p>Telescope matching provides an alternative, less model-dependent
approach to estimating the average controlled direct effect when both
treatment and mediator are binary. The average controlled direct effect
of interest is the effect of treatment versus control
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">A_i = 1</annotation></semantics></math>
vs.¬†<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">A_i = 0</annotation></semantics></math>)
holding constant the mediator at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">M_i = 0</annotation></semantics></math>).
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>C</mi><mi>D</mi><mi>E</mi><mo>=</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mi>Y</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
ACDE = E[Y_i(1, 0) - Y_i(0,0)]
</annotation></semantics></math></p>
<p>Identification still depends crucially on the sequential
unconfoundedness assumption <strong>Assumption 1</strong>, which states
that there are no unobserved confounders of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>A</mi><mi>i</mi></msub><annotation encoding="application/x-tex">A_i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Y_i</annotation></semantics></math>
given pre-treatment covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>
and that there are no unobserved confounders of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>i</mi></msub><annotation encoding="application/x-tex">M_i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Y_i</annotation></semantics></math>
given treatment
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>A</mi><mi>i</mi></msub><annotation encoding="application/x-tex">A_i</annotation></semantics></math>,
pre-treatment covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>
and post-treatment covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Z_i</annotation></semantics></math>.
We can understand the process of estimating the ACDE as an imputation
problem. Our estimator of the ACDE,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><annotation encoding="application/x-tex">\hat{\tau}</annotation></semantics></math>
is simply the average of imputed potential outcomes for each unit in the
sample.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>Y</mi><mo accent="true">ÃÇ</mo></mover><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mover><mi>Y</mi><mo accent="true">ÃÇ</mo></mover><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\hat{\tau} = \frac{1}{N}\sum_{i=1}^N \left(\widehat{Y}_i(1,0) - \widehat{Y}_i(0,0)\right)
</annotation></semantics></math></p>
<p>To obtain the imputations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Y</mi><mo accent="true">ÃÇ</mo></mover><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\widehat{Y}_i(1,0)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Y</mi><mo accent="true">ÃÇ</mo></mover><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\widehat{Y}_i(0,0)</annotation></semantics></math>
for each unit, the telescope matching approach proceeds in two stages.
The first step matches each unit with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">M_i = 1</annotation></semantics></math>
to some user-specified number of units with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">M_i = 0</annotation></semantics></math>
that share treatment status
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>A</mi><mi>i</mi></msub><annotation encoding="application/x-tex">A_i</annotation></semantics></math>
and are similar in both pre-treatment covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>
and post-treatment covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Z_i</annotation></semantics></math>
as measured by some distance metric (in <code>telescope_match</code> we
implement the Mahalanobis distance). Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>ùí•</mi><mi>L</mi><mi>m</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{J}_L^m(i)</annotation></semantics></math>
denote the set of units matched to unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.
We define the following imputation for each unit‚Äôs potential outcome
fixing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>i</mi></msub><annotation encoding="application/x-tex">M_i</annotation></semantics></math>
to 0.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Y</mi><mo accent="true">ÃÇ</mo></mover><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>A</mi><mi>i</mi></msub><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><msub><mi>Y</mi><mi>i</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> if </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mfrac><mn>1</mn><mi>L</mi></mfrac><munder><mo>‚àë</mo><mrow><mo>‚Ñì</mo><mo>‚àà</mo><msubsup><mi>ùí•</mi><mi>L</mi><mi>m</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></munder><msub><mi>Y</mi><mo>‚Ñì</mo></msub></mtd><mtd columnalign="left" style="text-align: left"><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> if </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\widehat{Y}_i(A_i, 0) =\begin{cases} Y_i &amp; \text{ if } M_i = 0 \\ \frac{1}{L} \sum_{\ell\in \mathcal{J}^m_L(i)} Y_{\ell} &amp; \text{ if } M_i = 1\end{cases}
</annotation></semantics></math></p>
<p>In the second step, we match each unit to some number of units of the
opposite treatment status with similar values of pre-treatment
covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>
Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>ùí•</mi><mi>L</mi><mi>a</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{J}_L^a(i)</annotation></semantics></math>
denote the set of units matched to unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>j</mi></msub><mo>=</mo><mn>1</mn><mo>‚àí</mo><msub><mi>A</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">A_j = 1 - A_i</annotation></semantics></math>
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>‚àà</mo><msubsup><mi>ùí•</mi><mi>L</mi><mi>a</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">j \in \mathcal{J}_L^a(i)</annotation></semantics></math>.
We then use the first-stage imputations for either unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
or its second-stage matches to impute the potential outcomes for each
unit under treatment and control fixing the mediator to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Y</mi><mo accent="true">ÃÇ</mo></mover><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><msub><mover><mi>Y</mi><mo accent="true">ÃÇ</mo></mover><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>A</mi><mi>i</mi></msub><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">if</mtext><mspace width="0.222em"></mspace><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>a</mi></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mfrac><mn>1</mn><mi>L</mi></mfrac><munder><mo>‚àë</mo><mrow><mi>j</mi><mo>‚àà</mo><msubsup><mi>ùí•</mi><mi>L</mi><mi>a</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></munder><msub><mover><mi>Y</mi><mo accent="true">ÃÇ</mo></mover><mi>j</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>A</mi><mi>j</mi></msub><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">if</mtext><mspace width="0.222em"></mspace><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn><mo>‚àí</mo><mi>a</mi></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
  \widehat{Y}_{i}(a,0) = \begin{cases}
    \widehat{Y}_{i}(A_i,0) &amp; \text{if}\ A_i = a\\
    \frac{1}{L} \sum_{j\in \mathcal{J}^a_L(i)} \widehat{Y}_{j}(A_j,0) &amp; \text{if}\  A_i = 1-a
\end{cases}
</annotation></semantics></math></p>
<p>Since matching is done with replacement, units may be used multiple
times. We define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>K</mi><mi>L</mi><mi>m</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>‚àë</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><mi>ùïÄ</mi><mo stretchy="false" form="prefix">{</mo><mi>i</mi><mo>‚àà</mo><msubsup><mi>ùí•</mi><mi>L</mi><mi>m</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">K^m_L(i) = \sum_{k=1}^N \mathbb{I}\{i \in \mathcal{J}^m_L(k)\}</annotation></semantics></math>
as the number of times that unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
is used as a match in stage and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>K</mi><mi>L</mi><mi>a</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>‚àë</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><mi>ùïÄ</mi><mo stretchy="false" form="prefix">{</mo><mi>i</mi><mo>‚àà</mo><msubsup><mi>ùí•</mi><mi>L</mi><mi>a</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">K^a_L(i) = \sum_{j=1}^N \mathbb{I}\{i \in \mathcal{J}^a_L(j)\}</annotation></semantics></math>.
Moreover, since units with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">M_i = 0</annotation></semantics></math>
contribute indirectly to second stage matches we define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>K</mi><mi>L</mi><mrow><mi>a</mi><mi>m</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>‚àë</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><mi>ùïÄ</mi><mo stretchy="false" form="prefix">{</mo><mi>i</mi><mo>‚àà</mo><msubsup><mi>ùí•</mi><mi>L</mi><mi>m</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo><msubsup><mi>K</mi><mi>L</mi><mi>a</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">K^{am}_L(i) = \sum_{j=1}^N \mathbb{I}\{i \in \mathcal{J}^m_L(j)\}K^a_L(j)</annotation></semantics></math>
to denote the number of times a unit with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">M_i = 0</annotation></semantics></math>
matched to a unit with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">M_i = 1</annotation></semantics></math>
is implicitly used as a match in the second stage. This allows us to
re-write the simple matching estimator as a weighted average
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><mo>=</mo><msup><mi>N</mi><mrow><mo>‚àí</mo><mn>1</mn></mrow></msup><msubsup><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><msub><mi>A</mi><mi>i</mi></msub><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>M</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>W</mi><mi>i</mi></msub><msub><mi>Y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\widehat{\tau} = N^{-1} \sum_{i=1}^N (2A_i - 1)(1 - M_i)W_iY_i</annotation></semantics></math>
where the weight is defined as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn><mo>+</mo><mfrac><mrow><msubsup><mi>K</mi><mi>L</mi><mi>a</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mi>L</mi></mfrac><mo>+</mo><mfrac><mrow><msubsup><mi>K</mi><mi>L</mi><mi>m</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mi>L</mi></mfrac><mo>+</mo><mfrac><mrow><msubsup><mi>K</mi><mi>L</mi><mrow><mi>a</mi><mi>m</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msup><mi>L</mi><mn>2</mn></msup></mfrac></mrow><annotation encoding="application/x-tex">
  W_i =  1 + \frac{K^a_L(i)}{L} + \frac{K^m_L(i)}{L} + \frac{K^{am}_L(i)}{L^2}
</annotation></semantics></math></p>
<p>These weights can be used as a diagnostic for assessing the variance
of the estimator and whether particular observations have an extreme
influence on the estimate through large weights, resulting in large
variances. The <code>telescope_match</code> function returns each of the
constituent matching counts along with the combined matching ‚Äúweight‚Äù on
each observation for use in diagnostic plots.</p>
<div class="section level3">
<h3 id="bias-correction-for-matching">Bias correction for matching<a class="anchor" aria-label="anchor" href="#bias-correction-for-matching"></a>
</h3>
<p>Matching estimators with a fixed number of matches exhibit bias even
in large samples due to differences in the regression function between
units and their matches evaluated at their respective covariate values
<span class="citation">Abadie and Imbens (<a href="#ref-AbaImb11">2011</a>)</span>. While this bias converges in
probability to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
as the sample size grows, the rate of convergence is slow enough that
the bias terms dominate the distribution To address this, matching
estimators for treatment effects typically incorporate a bias correction
which adjusts the matched values by the estimated difference in
regression functions. We incorporate a similar approach for correcting
matching bias in our two-stage procedure.</p>
<p>The bias of the simple matching estimator for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>œÑ</mi><mo accent="true">ÃÇ</mo></mover><annotation encoding="application/x-tex">\hat{\tau}</annotation></semantics></math>
consists of two terms, a bias due to matching on the mediator
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>B</mi><mi>L</mi><mi>m</mi></msubsup><annotation encoding="application/x-tex">B_L^m</annotation></semantics></math>)
and a bias due to matching on treatment
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>B</mi><mi>L</mi><mi>a</mi></msubsup><annotation encoding="application/x-tex">B_L^a</annotation></semantics></math>)</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>B</mi><mi>L</mi><mi>m</mi></msubsup><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><msub><mi>A</mi><mi>i</mi></msub><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>M</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><msubsup><mi>K</mi><mi>L</mi><mi>a</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mi>L</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mn>1</mn><mi>L</mi></mfrac><munder><mo>‚àë</mo><mrow><mo>‚Ñì</mo><mo>‚àà</mo><msubsup><mi>J</mi><mi>L</mi><mi>m</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></munder><msub><mi>Œº</mi><mrow><msub><mi>A</mi><mi>i</mi></msub><mn>0</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mo>‚Ñì</mo></msub><mo>,</mo><msub><mi>Z</mi><mo>‚Ñì</mo></msub><mo>,</mo><msub><mi>A</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mi>Œº</mi><mrow><msub><mi>A</mi><mi>i</mi></msub><mn>0</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo>,</mo><msub><mi>Z</mi><mi>i</mi></msub><mo>,</mo><msub><mi>A</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
 B^m_L = \frac{1}{N} \sum_{i=1}^N (2A_i - 1)M_i \left(1 + \frac{K^a_L(i)}{L}\right)  \left( \frac{1}{L} \sum_{{\ell} \in J^m_L(i)} \mu_{A_i0}(X_{\ell}, Z_{\ell}, A_i) - \mu_{A_i0}(X_i, Z_i, A_i) \right) 
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>B</mi><mi>L</mi><mi>a</mi></msubsup><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><msub><mi>A</mi><mi>i</mi></msub><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo minsize="3.0" maxsize="3.0" stretchy="false" form="prefix">[</mo><mfrac><mn>1</mn><mi>L</mi></mfrac><munder><mo>‚àë</mo><mrow><mi>j</mi><mo>‚àà</mo><msubsup><mi>J</mi><mi>L</mi><mi>a</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></munder><msub><mi>Œº</mi><mrow><mn>1</mn><mo>‚àí</mo><msub><mi>A</mi><mi>i</mi></msub><mo>,</mo><mn>0</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo>,</mo><mn>1</mn><mo>‚àí</mo><msub><mi>A</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mi>Œº</mi><mrow><mn>1</mn><mo>‚àí</mo><msub><mi>A</mi><mi>i</mi></msub><mo>,</mo><mn>0</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>j</mi></msub><mo>,</mo><mn>1</mn><mo>‚àí</mo><msub><mi>A</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo minsize="3.0" maxsize="3.0" stretchy="false" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">
  B^a_L = \frac{1}{N} \sum_{i=1}^N (2A_i - 1) \Bigg[\frac{1}{L} \sum_{j \in J^a_L(i)} \mu_{1-A_i,0}(X_i,1-A_i) - \mu_{1-A_i,0}(X_j,1-A_i)   \Bigg]
</annotation></semantics></math></p>
<p>Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mrow><mi>a</mi><mi>m</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚à£</mo><msub><mi>X</mi><mi>i</mi></msub><mo>=</mo><mi>x</mi><mo>,</mo><msub><mi>Z</mi><mi>i</mi></msub><mo>=</mo><mi>z</mi><mo>,</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>a</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_{am}(x,z,a) = E[Y(a,m) \mid X_i = x, Z_i = z, A_i = a]</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mrow><mi>a</mi><mi>m</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚à£</mo><msub><mi>X</mi><mi>i</mi></msub><mo>=</mo><mi>x</mi><mo>,</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>a</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_{am}(x,a) = E[Y_i(a,m) \mid X_i= x, A_i = a]</annotation></semantics></math>
denote the conditional expectations of the potential outcomes given two
different conditioning sets (with and without
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>).
Under sequential ignorability,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mrow><mi>a</mi><mi>m</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>Œº</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mo>‚à£</mo><msub><mi>X</mi><mi>i</mi></msub><mo>=</mo><mi>x</mi><mo>,</mo><msub><mi>Z</mi><mi>i</mi></msub><mo>=</mo><mi>z</mi><mo>,</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>a</mi><mo>,</mo><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><mi>m</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_{am}(x,z,a) = \mu(x,z,a,m) = E[Y_i \mid X_i= x, Z_i = z, A_i = a, M_i = m]</annotation></semantics></math>.
The method implemented in <code>telescope_match</code> extends the bias
correction strategy of <span class="citation">Abadie and Imbens (<a href="#ref-AbaImb11">2011</a>)</span> to the two-stage setting. It
estimates the two conditional expectation functions using regression
estimators
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>Œº</mi><mo accent="true">ÃÇ</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>z</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\widehat{\mu}(x, z, a, m)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Œº</mi><mo accent="true">ÃÇ</mo></mover><mrow><mi>a</mi><mn>0</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\widehat{\mu}_{a0}(x, a)</annotation></semantics></math>.
As shown in <span class="citation">Blackwell and Strezhnev (<a href="#ref-BlaStr21">2021</a>)</span>, if the regression estimators are
consistent for the true regression functions, then the estimated bias
correction converges to the true bias. The rate of convergence is fast
enough such that the bias can be ignored asymptotically.</p>
</div>
<div class="section level3">
<h3 id="inference">Inference<a class="anchor" aria-label="anchor" href="#inference"></a>
</h3>
<p>Obtaining valid standard errors in the matching context is difficult
as matching with replacement induces dependencies between imputed
potential outcomes. We provide two approaches for estimating standard
errors. The first implements a version of the <span class="citation">Otsu and Rai (<a href="#ref-OtsRai17">2017</a>)</span>
wild bootstrap for matching estimators, extended to the two-stage
setting. The second (default) approach estimates the components of the
asymptotic variance derived in <span class="citation">Blackwell and
Strezhnev (<a href="#ref-BlaStr21">2021</a>)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="empirical-illustration-of-telescope-matching">Empirical illustration of telescope matching<a class="anchor" aria-label="anchor" href="#empirical-illustration-of-telescope-matching"></a>
</h2>
<p>In this section, we illustrate the implementation of the telescope
matching estimator as applied to the Job Corps experiment data used in
<span class="citation">Huber (<a href="#ref-Hub14">2014</a>)</span> to
estimate the effect of a randomized job training program on
self-assessed health holding constant the intermediate outcome of
employment.</p>
<p>The data is supplied along with the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">jobcorps</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Y_i</annotation></semantics></math>
is an indicator for whether participants reported ‚Äúvery good‚Äù health
after 2.5 years out after randomization (<code>exhealth30</code>)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>A</mi><mi>i</mi></msub><annotation encoding="application/x-tex">A_i</annotation></semantics></math>
is an indicator for assignment to the job training program
(<code>treat</code>)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>i</mi></msub><annotation encoding="application/x-tex">M_i</annotation></semantics></math>
is an indicator for employment 1 to 1.5 years after assignment
(<code>work2year2q</code>)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Z_i</annotation></semantics></math>
are the post-treatment, pre-mediator intermediate confounders
(<code>emplq4</code>, <code>emplq4full</code>)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>
are the pre-treatment characteristics (<code>chobef</code>,
<code>trainyrbef</code>, <code>jobeverbef</code>)</li>
</ul>
<p>The original <span class="citation">Huber (<a href="#ref-Hub14">2014</a>)</span> paper looks at separate controlled
effects for female and male participants. We start by subsetting the
dataset down to the female participants</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jobcorps_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">jobcorps</span>, <span class="va">female</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We define the two formula objects used for matching, the first
including all pre- and post-treatment covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>i</mi></msub><annotation encoding="application/x-tex">X_i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Z_i</annotation></semantics></math>
along with all treatment-covariate interactions. The second includes
only the pre-treatment covariates and treatment-covariate interactions.
Here, we include only a subset of the covariates used by <span class="citation">Huber (<a href="#ref-Hub14">2014</a>)</span> in their
analysis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Telescope matching formula - First stage (X and Z)</span></span>
<span><span class="va">tm_form</span> <span class="op">&lt;-</span> <span class="va">exhealth30</span> <span class="op">~</span> <span class="va">schobef</span> <span class="op">+</span> <span class="va">trainyrbef</span> <span class="op">+</span> <span class="va">jobeverbef</span>  <span class="op">|</span> <span class="va">treat</span> <span class="op">|</span></span>
<span>  <span class="va">emplq4</span> <span class="op">+</span> <span class="va">emplq4full</span> <span class="op">|</span> <span class="va">work2year2q</span></span></code></pre></div>
<p>The <code><a href="../reference/telescope_match.html">telescope_match()</a></code> function can handle additional
mediators and intermediate covariates by simply adding them to the end
of the formula in the same manner as these two groups. We then pass this
formula to the function itself:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### Estimate ACDE for women holding employment at 0</span></span>
<span><span class="va">tm_out</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/telescope_match.html">telescope_match</a></span><span class="op">(</span><span class="va">tm_form</span>, data <span class="op">=</span> <span class="va">jobcorps_female</span>, L <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Beginning matching...</span></span></code></pre>
<pre><code><span><span class="co">## Matching work2year2q...</span></span></code></pre>
<pre><code><span><span class="co">## Matching treat...</span></span></code></pre>
<pre><code><span><span class="co">## Beginning bias correction...</span></span></code></pre>
<p>The <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function will print the output (estimate
and standard errors) to the console for each of the possible controlled
direct effects. This function also provides some summaries of the
matching output. The elements of the output can be accessed directly
from the returned <code>tmatch</code> object.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prints the summary output</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">tm_out</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Telescope matching results</span></span>
<span><span class="co">## ----------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## telescope_match(formula = tm_form, data = jobcorps_female, L = 3)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Active treatment:  treat </span></span>
<span><span class="co">## Controlled treatment(s): work2year2q </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matching summary:</span></span>
<span><span class="co">##          Term Matching Ratio L:1 N == 1 N == 0 Matched == 1 Matched == 0</span></span>
<span><span class="co">## 1       treat                  3   2801   1551         2273         1546</span></span>
<span><span class="co">## 2 work2year2q                  3   2559   1793         1355         1497</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Summary of units matching contributions:</span></span>
<span><span class="co">##                   Min.   1st Qu.    Median Mean  3rd Qu.      Max.</span></span>
<span><span class="co">## treat                0 0.3333333 0.6666667    1 1.333333   5.00000</span></span>
<span><span class="co">## treat:work2year2q    0 0.0000000 0.3333333    1 1.000000 116.88889</span></span>
<span><span class="co">## work2year2q          0 0.0000000 0.3333333    1 1.333333  72.66667</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimated controlled direct effects of treat:</span></span>
<span><span class="co">##                   work2year2q Estimate Estimate (no BC) Std. Err.</span></span>
<span><span class="co">## (1, 0) vs. (0, 0)           0 -0.08482         -0.07573   0.05231</span></span>
<span><span class="co">## (1, 1) vs. (0, 1)           1  0.02369          0.02367   0.02285</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The coefficients + SE can be accessed directly as well</span></span>
<span><span class="va">tm_out</span><span class="op">$</span><span class="va">tau</span> <span class="co"># Point estimate</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -0.08481891  0.02368883</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tm_out</span><span class="op">$</span><span class="va">tau_se</span> <span class="co">#Standard error</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.05231118 0.02284633</span></span></code></pre>
<p>Additional diagnostics can be conducted by calling the
<code><a href="../reference/balance.tmatch.html">balance.tmatch()</a></code> function on the returned
<code>tmatch</code> object to assess the change in pre-/post-matching
covariate balance in both the first and second stages.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Assess mediator balance on selected pre- and post- treatment covariates</span></span>
<span><span class="fu"><a href="../reference/balance.tmatch.html">balance.tmatch</a></span><span class="op">(</span><span class="va">tm_out</span>, vars <span class="op">=</span> <span class="va">work2year2q</span> <span class="op">~</span> <span class="va">schobef</span> <span class="op">+</span> <span class="va">emplq4</span>,</span>
<span>               data <span class="op">=</span> <span class="va">jobcorps_female</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         variable  before_0  before_1   after_0   after_1 before_sd  before_diff</span></span>
<span><span class="co">## schobef  schobef 0.6352482 0.6287612 0.7033548 0.6314338 0.4824714 -0.006486953</span></span>
<span><span class="co">## emplq4    emplq4 0.1996654 0.7198124 0.4771752 0.5057445 0.5000270  0.520147061</span></span>
<span><span class="co">##         before_std_diff  after_diff after_std_diff</span></span>
<span><span class="co">## schobef     -0.01344526 -0.07192096    -0.14906782</span></span>
<span><span class="co">## emplq4       1.04023787  0.02856924     0.05713539</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Assess treatment balance on selected pre-treatment covariates</span></span>
<span><span class="fu"><a href="../reference/balance.tmatch.html">balance.tmatch</a></span><span class="op">(</span><span class="va">tm_out</span>, vars <span class="op">=</span> <span class="va">treat</span> <span class="op">~</span> <span class="va">trainyrbef</span> <span class="op">+</span> <span class="va">hhsize</span>,</span>
<span>               data <span class="op">=</span> <span class="va">jobcorps_female</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              variable   before_0   before_1    after_0    after_1 before_sd</span></span>
<span><span class="co">## trainyrbef trainyrbef 0.01676338 0.01713674 0.01700368 0.01700368 0.1292996</span></span>
<span><span class="co">## hhsize         hhsize 4.54094133 4.53802213 4.55935968 4.53592218 2.2087850</span></span>
<span><span class="co">##              before_diff before_std_diff after_diff after_std_diff</span></span>
<span><span class="co">## trainyrbef  0.0003733584     0.002887544  0.0000000     0.00000000</span></span>
<span><span class="co">## hhsize     -0.0029191932    -0.001321629 -0.0234375    -0.01061104</span></span></code></pre>
<p>Calling the <code><a href="../reference/plotDiag.tmatch.html">plotDiag.tmatch()</a></code> function will return a
histogram of the number of times each unit is used as a match
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mi>/</mi><mi>L</mi></mrow><annotation encoding="application/x-tex">K/L</annotation></semantics></math>)
in either the first (mediator) stage or the second (treatment)
stage.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of times each unit is used as a match in the mediator (first) stage</span></span>
<span><span class="fu"><a href="../reference/plotDiag.tmatch.html">plotDiag.tmatch</a></span><span class="op">(</span><span class="va">tm_out</span>, stage <span class="op">=</span> <span class="st">"work2year2q"</span><span class="op">)</span></span></code></pre></div>
<p><img src="telescope_matching_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of times each unit is used as a match in the treatment (second) stage</span></span>
<span><span class="fu"><a href="../reference/plotDiag.tmatch.html">plotDiag.tmatch</a></span><span class="op">(</span><span class="va">tm_out</span>, stage <span class="op">=</span> <span class="st">"treat"</span><span class="op">)</span></span></code></pre></div>
<p><img src="telescope_matching_files/figure-html/unnamed-chunk-7-2.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-AbaImb11" class="csl-entry">
Abadie, Alberto, and Guido W Imbens. 2011. <span>‚ÄúBias-Corrected
Matching Estimators for Average Treatment Effects.‚Äù</span> <em>Journal
of Business &amp; Economic Statistics</em> 29 (1): 1‚Äì11.
</div>
<div id="ref-BlaStr21" class="csl-entry">
Blackwell, Matthew, and Anton Strezhnev. 2021. <span>‚ÄúTelescope Matching
for Reducing Model Dependence in the Estimation of the Effects of
Time-Varying Treatments: An Application to Negative Advertising.‚Äù</span>
<em>Journal of the Royal Statistical Society (Series A)</em>.
</div>
<div id="ref-Hub14" class="csl-entry">
Huber, Martin. 2014. <span>‚ÄúIdentifying Causal Mechanisms (Primarily)
Based on Inverse Probability Weighting.‚Äù</span> <em>Journal of Applied
Econometrics</em> 29 (6): 920‚Äì43.
</div>
<div id="ref-OtsRai17" class="csl-entry">
Otsu, Taisuke, and Yoshiyasu Rai. 2017. <span>‚ÄúBootstrap Inference of
Matching Estimators for Average Treatment Effects.‚Äù</span> <em>Journal
of the American Statistical Association</em> 112 (520): 1720‚Äì32.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Blackwell, Avidit Acharya, Maya Sen, Shiro Kuriwaki, Jacob Brown, Anton Strezhnev.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>

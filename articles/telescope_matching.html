<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="DirectEffects">
<title>Telescope matching • DirectEffects</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Telescope matching">
<meta property="og:description" content="DirectEffects">
<meta property="og:image" content="https://mattblackwell.github.io/DirectEffects/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DirectEffects</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/DirectEffects.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/assembly_line.html">Assmebly Line</a>
    <a class="dropdown-item" href="../articles/telescope_matching.html">Telescope matching</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mattblackwell/DirectEffects/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="telescope_matching_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Telescope matching</h1>
            
            <h4 data-toc-skip class="date">2022-03-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mattblackwell/DirectEffects/blob/HEAD/vignettes/articles/telescope_matching.Rmd" class="external-link"><code>vignettes/articles/telescope_matching.Rmd</code></a></small>
      <div class="d-none name"><code>telescope_matching.Rmd</code></div>
    </div>

    
    
<p>This vignette illustrates the telescope matching method developed in <span class="citation">Blackwell and Strezhnev (<a href="#ref-BlaStr21" role="doc-biblioref">2021</a>)</span> as implemented in the <code>telescope_matching</code> routine. One drawback of sequential g-estimation or other model-based estimators is that they depend on correctly specifying two regression models: one for the effect of the mediator given treatment and pre-/post-treatment covariates and another for the effect of treatment given pre-treatment covariates. Telescope matching provides a more flexible and less model-dependent estimation strategy for controlled direct effects when the treatment and mediator are binary. It combines a two-stage matching procedure to impute the unobserved counterfactuals with a bias-correction to account for biases induced by imperfect matches.</p>
<div class="section level2">
<h2 id="estimation-by-telescope-matching">Estimation by telescope matching<a class="anchor" aria-label="anchor" href="#estimation-by-telescope-matching"></a>
</h2>
<p>Telescope matching provides an alternative, less model-dependent approach to estimating the average controlled direct effect when both treatment and mediator are binary. The average controlled direct effect of interest is the effect of treatment versus control (<span class="math inline">\(A_i = 1\)</span> vs. <span class="math inline">\(A_i = 0\)</span>) holding constant the mediator at <span class="math inline">\(0\)</span> (<span class="math inline">\(M_i = 0\)</span>). <span class="math display">\[
ACDE = E[Y_i(1, 0) - Y_i(0,0)]
\]</span></p>
<p>Identification still depends crucially on the sequential unconfoundedness assumption <strong>Assumption 1</strong>, which states that there are no unobserved confounders of <span class="math inline">\(A_i\)</span> and <span class="math inline">\(Y_i\)</span> given pre-treatment covariates <span class="math inline">\(X_i\)</span> and that there are no unobserved confounders of <span class="math inline">\(M_i\)</span> and <span class="math inline">\(Y_i\)</span> given treatment <span class="math inline">\(A_i\)</span>, pre-treatment covariates <span class="math inline">\(X_i\)</span> and post-treatment covariates <span class="math inline">\(Z_i\)</span>. We can understand the process of estimating the ACDE as an imputation problem. Our estimator of the ACDE, <span class="math inline">\(\hat{\tau}\)</span> is simply the average of imputed potential outcomes for each unit in the sample. <span class="math display">\[
\hat{\tau} = \frac{1}{N}\sum_{i=1}^N \left(\widehat{Y}_i(1,0) - \widehat{Y}_i(0,0)\right)
\]</span></p>
<p>To obtain the imputations <span class="math inline">\(\widehat{Y}_i(1,0)\)</span> and <span class="math inline">\(\widehat{Y}_i(0,0)\)</span> for each unit, the telescope matching approach proceeds in two stages. The first step matches each unit with <span class="math inline">\(M_i = 1\)</span> to some user-specified number of units with <span class="math inline">\(M_i = 0\)</span> that share treatment status <span class="math inline">\(A_i\)</span> and are similar in both pre-treatment covariates <span class="math inline">\(X_i\)</span> and post-treatment covariates <span class="math inline">\(Z_i\)</span> as measured by some distance metric (in <code>telescope_match</code> we implement the Mahalanobis distance). Let <span class="math inline">\(\mathcal{J}_L^m(i)\)</span> denote the set of units matched to unit <span class="math inline">\(i\)</span>. We define the following imputation for each unit’s potential outcome fixing <span class="math inline">\(M_i\)</span> to 0.</p>
<p><span class="math display">\[
\widehat{Y}_i(A_i, 0) =\begin{cases} Y_i &amp; \text{ if } M_i = 0 \\ \frac{1}{L} \sum_{\ell\in \mathcal{J}^m_L(i)} Y_{\ell} &amp; \text{ if } M_i = 1\end{cases}
\]</span></p>
<p>In the second step, we match each unit to some number of units of the opposite treatment status with similar values of pre-treatment covariates <span class="math inline">\(X_i\)</span> Let <span class="math inline">\(\mathcal{J}_L^a(i)\)</span> denote the set of units matched to unit <span class="math inline">\(i\)</span> such that <span class="math inline">\(A_j = 1 - A_i\)</span> for all <span class="math inline">\(j \in \mathcal{J}_L^a(i)\)</span>. We then use the first-stage imputations for either unit <span class="math inline">\(i\)</span> or its second-stage matches to impute the potential outcomes for each unit under treatment and control fixing the mediator to <span class="math inline">\(0\)</span>.</p>
<p><span class="math display">\[
  \widehat{Y}_{i}(a,0) = \begin{cases}
    \widehat{Y}_{i}(A_i,0) &amp; \text{if}\ A_i = a\\
    \frac{1}{L} \sum_{j\in \mathcal{J}^a_L(i)} \widehat{Y}_{j}(A_j,0) &amp; \text{if}\  A_i = 1-a
\end{cases}
\]</span></p>
<p>Since matching is done with replacement, units may be used multiple times. We define <span class="math inline">\(K^m_L(i) = \sum_{k=1}^N \mathbb{I}\{i \in \mathcal{J}^m_L(k)\}\)</span> as the number of times that unit <span class="math inline">\(i\)</span> is used as a match in stage and <span class="math inline">\(K^a_L(i) = \sum_{j=1}^N \mathbb{I}\{i \in \mathcal{J}^a_L(j)\}\)</span>. Moreover, since units with <span class="math inline">\(M_i = 0\)</span> contribute indirectly to second stage matches we define <span class="math inline">\(K^{am}_L(i) = \sum_{j=1}^N \mathbb{I}\{i \in \mathcal{J}^m_L(j)\}K^a_L(j)\)</span> to denote the number of times a unit with <span class="math inline">\(M_i = 0\)</span> matched to a unit with <span class="math inline">\(M_i = 1\)</span> is implicitly used as a match in the second stage. This allows us to re-write the simple matching estimator as a weighted average <span class="math inline">\(\widehat{\tau} = N^{-1} \sum_{i=1}^N (2A_i - 1)(1 - M_i)W_iY_i\)</span> where the weight is defined as</p>
<p><span class="math display">\[
  W_i =  1 + \frac{K^a_L(i)}{L} + \frac{K^m_L(i)}{L} + \frac{K^{am}_L(i)}{L^2}
\]</span></p>
<p>These weights can be used as a diagnostic for assessing the variance of the estimator and whether particular observations have an extreme influence on the estimate through large weights, resulting in large variances. The <code>telescope_match</code> function returns each of the constituent matching counts along with the combined matching “weight” on each observation for use in diagnostic plots.</p>
<div class="section level3">
<h3 id="bias-correction-for-matching">Bias correction for matching<a class="anchor" aria-label="anchor" href="#bias-correction-for-matching"></a>
</h3>
<p>Matching estimators with a fixed number of matches exhibit bias even in large samples due to differences in the regression function between units and their matches evaluated at their respective covariate values <span class="citation">Abadie and Imbens (<a href="#ref-AbaImb11" role="doc-biblioref">2011</a>)</span>. While this bias converges in probability to <span class="math inline">\(0\)</span> as the sample size grows, the rate of convergence is slow enough that the bias terms dominate the distribution To address this, matching estimators for treatment effects typically incorporate a bias correction which adjusts the matched values by the estimated difference in regression functions. We incorporate a similar approach for correcting matching bias in our two-stage procedure.</p>
<p>The bias of the simple matching estimator for <span class="math inline">\(\hat{\tau}\)</span> consists of two terms, a bias due to matching on the mediator (<span class="math inline">\(B_L^m\)</span>) and a bias due to matching on treatment (<span class="math inline">\(B_L^a\)</span>)</p>
<p><span class="math display">\[
 B^m_L = \frac{1}{N} \sum_{i=1}^N (2A_i - 1)M_i \left(1 + \frac{K^a_L(i)}{L}\right)  \left( \frac{1}{L} \sum_{{\ell} \in J^m_L(i)} \mu_{A_i0}(X_{\ell}, Z_{\ell}, A_i) - \mu_{A_i0}(X_i, Z_i, A_i) \right) 
\]</span></p>
<p><span class="math display">\[
  B^a_L = \frac{1}{N} \sum_{i=1}^N (2A_i - 1) \Bigg[\frac{1}{L} \sum_{j \in J^a_L(i)} \mu_{1-A_i,0}(X_i,1-A_i) - \mu_{1-A_i,0}(X_j,1-A_i)   \Bigg]
\]</span></p>
<p>Where <span class="math inline">\(\mu_{am}(x,z,a) = E[Y(a,m) \mid X_i = x, Z_i = z, A_i = a]\)</span> and <span class="math inline">\(\mu_{am}(x,a) = E[Y_i(a,m) \mid X_i= x, A_i = a]\)</span> denote the conditional expectations of the potential outcomes given two different conditioning sets (with and without <span class="math inline">\(Z\)</span>). Under sequential ignorability, <span class="math inline">\(\mu_{am}(x,z,a) = \mu(x,z,a,m) = E[Y_i \mid X_i= x, Z_i = z, A_i = a, M_i = m]\)</span>. The method implemented in <code>telescope_match</code> extends the bias correction strategy of <span class="citation">Abadie and Imbens (<a href="#ref-AbaImb11" role="doc-biblioref">2011</a>)</span> to the two-stage setting. It estimates the two conditional expectation functions using regression estimators <span class="math inline">\(\widehat{\mu}(x, z, a, m)\)</span> and <span class="math inline">\(\widehat{\mu}_{a0}(x, a)\)</span>. As shown in <span class="citation">Blackwell and Strezhnev (<a href="#ref-BlaStr21" role="doc-biblioref">2021</a>)</span>, if the regression estimators are consistent for the true regression functions, then the estimated bias correction converges to the true bias. The rate of convergence is fast enough such that the bias can be ignored asymptotically.</p>
</div>
<div class="section level3">
<h3 id="inference">Inference<a class="anchor" aria-label="anchor" href="#inference"></a>
</h3>
<p>Obtaining valid standard errors in the matching context is difficult as matching with replacement induces dependencies between imputed potential outcomes. We provide two approaches for estimating standard errors. The first implements a version of the <span class="citation">Otsu and Rai (<a href="#ref-OtsRai17" role="doc-biblioref">2017</a>)</span> wild bootstrap for matching estimators, extended to the two-stage setting. The second (default) approach estimates the components of the asymptotic variance derived in <span class="citation">Blackwell and Strezhnev (<a href="#ref-BlaStr21" role="doc-biblioref">2021</a>)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="empirical-illustration-of-telescope-matching">Empirical illustration of telescope matching<a class="anchor" aria-label="anchor" href="#empirical-illustration-of-telescope-matching"></a>
</h2>
<p>In this section, we illustrate the implementation of the telescope matching estimator as applied to the Job Corps experiment data used in <span class="citation">Huber (<a href="#ref-Hub14" role="doc-biblioref">2014</a>)</span> to estimate the effect of a randomized job training program on self-assessed health holding constant the intermediate outcome of employment.</p>
<p>The data is supplied along with the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">jobcorps</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<span class="math inline">\(Y_i\)</span> is an indicator for whether participants reported “very good” health after 2.5 years out after randomization (<code>exhealth30</code>)</li>
<li>
<span class="math inline">\(A_i\)</span> is an indicator for assignment to the job training program (<code>treat</code>)</li>
<li>
<span class="math inline">\(M_i\)</span> is an indicator for employment 1 to 1.5 years after assignment (<code>work2year2q</code>)</li>
<li>
<span class="math inline">\(Z_i\)</span> are the post-treatment, pre-mediator intermediate confounders (<code>emplq4</code>, <code>emplq4full</code>)</li>
<li>
<span class="math inline">\(X_i\)</span> are the pre-treatment characteristics (<code>chobef</code>, <code>trainyrbef</code>, <code>jobeverbef</code>)</li>
</ul>
<p>The original <span class="citation">Huber (<a href="#ref-Hub14" role="doc-biblioref">2014</a>)</span> paper looks at separate controlled effects for female and male participants. We start by subsetting the dataset down to the female participants</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">jobcorps_female</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">jobcorps</span>, <span class="va">female</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>We define the two formula objects used for matching, the first including all pre- and post-treatment covariates <span class="math inline">\(X_i\)</span> and <span class="math inline">\(Z_i\)</span> along with all treatment-covariate interactions. The second includes only the pre-treatment covariates and treatment-covariate interactions. Here, we include only a subset of the covariates used by <span class="citation">Huber (<a href="#ref-Hub14" role="doc-biblioref">2014</a>)</span> in their analysis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Telescope matching formula - First stage (X and Z)</span>
<span class="va">tm_form</span> <span class="op">&lt;-</span> <span class="va">exhealth30</span> <span class="op">~</span> <span class="va">schobef</span> <span class="op">+</span> <span class="va">trainyrbef</span> <span class="op">+</span> <span class="va">jobeverbef</span>  <span class="op">|</span> <span class="va">treat</span> <span class="op">|</span>
  <span class="va">emplq4</span> <span class="op">+</span> <span class="va">emplq4full</span> <span class="op">|</span> <span class="va">work2year2q</span></code></pre></div>
<p>The <code><a href="../reference/telescope_match.html">telescope_match()</a></code> function can handle additional mediators and intermediate covariates by simply adding them to the end of the formula in the same manner as these two groups. We then pass this formula to the function itself:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### Estimate ACDE for women holding employment at 0</span>
<span class="va">tm_out</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/telescope_match.html">telescope_match</a></span><span class="op">(</span><span class="va">tm_form</span>, data <span class="op">=</span> <span class="va">jobcorps_female</span>, L <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Beginning matching...</span></code></pre>
<pre><code><span class="co">## Matching work2year2q...</span></code></pre>
<pre><code><span class="co">## Matching treat...</span></code></pre>
<pre><code><span class="co">## Beginning bias correction...</span></code></pre>
<p>The <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function will print the output (estimate and standard errors) to the console for each of the possible controlled direct effects. This function also provides some summaries of the matching output. The elements of the output can be accessed directly from the returned <code>tmatch</code> object.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Prints the summary output</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">tm_out</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Telescope matching results</span>
<span class="co">## ----------------------------</span>
<span class="co">## </span>
<span class="co">## Call:</span>
<span class="co">## telescope_match(formula = tm_form, data = jobcorps_female, L = 3)</span>
<span class="co">## </span>
<span class="co">## Active treatment:  treat </span>
<span class="co">## Controlled treatment(s): work2year2q </span>
<span class="co">## </span>
<span class="co">## Matching summary:</span>
<span class="co">##          Term Matching Ratio L:1 N == 1 N == 0 Matched == 1 Matched == 0</span>
<span class="co">## 1       treat                  3   2801   1551         2275         1545</span>
<span class="co">## 2 work2year2q                  3   2559   1793         1369         1514</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## Summary of units matching contributions:</span>
<span class="co">##                   Min.   1st Qu.    Median Mean  3rd Qu.       Max.</span>
<span class="co">## treat                0 0.3333333 0.6666667    1 1.333333   4.666667</span>
<span class="co">## treat:work2year2q    0 0.0000000 0.3333333    1 1.000000 124.333333</span>
<span class="co">## work2year2q          0 0.0000000 0.3333333    1 1.333333  67.666667</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## Estimated controlled direct effects of treat:</span>
<span class="co">##                   work2year2q Estimate Estimate (no BC) Std. Err.</span>
<span class="co">## (1, 0) vs. (0, 0)           0 -0.08189         -0.07207   0.05252</span>
<span class="co">## (1, 1) vs. (0, 1)           1  0.03563          0.03562   0.02255</span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The coefficients + SE can be accessed directly as well</span>
<span class="va">tm_out</span><span class="op">$</span><span class="va">tau</span> <span class="co"># Point estimate</span></code></pre></div>
<pre><code><span class="co">## [1] -0.08189419  0.03562810</span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tm_out</span><span class="op">$</span><span class="va">tau_se</span> <span class="co">#Standard error</span></code></pre></div>
<pre><code><span class="co">## [1] 0.05251830 0.02255062</span></code></pre>
<p>Additional diagnostics can be conducted by calling the <code><a href="../reference/balance.tmatch.html">balance.tmatch()</a></code> function on the returned <code>tmatch</code> object to assess the change in pre-/post-matching covariate balance in both the first and second stages.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Assess mediator balance on selected pre- and post- treatment covariates</span>
<span class="fu"><a href="../reference/balance.tmatch.html">balance.tmatch</a></span><span class="op">(</span><span class="va">tm_out</span>, vars <span class="op">=</span> <span class="va">work2year2q</span> <span class="op">~</span> <span class="va">schobef</span> <span class="op">+</span> <span class="va">emplq4</span>,
               data <span class="op">=</span> <span class="va">jobcorps_female</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##         variable  before_0  before_1   after_0   after_1 before_sd  before_diff</span>
<span class="co">## schobef  schobef 0.6352482 0.6287612 0.7040441 0.6314338 0.4824714 -0.006486953</span>
<span class="co">## emplq4    emplq4 0.1996654 0.7198124 0.4778646 0.5057445 0.5000270  0.520147061</span>
<span class="co">##         before_std_diff  after_diff after_std_diff</span>
<span class="co">## schobef     -0.01344526 -0.07261029    -0.15049658</span>
<span class="co">## emplq4       1.04023787  0.02787990     0.05575679</span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Assess treatment balance on selected pre-treatment covariates</span>
<span class="fu"><a href="../reference/balance.tmatch.html">balance.tmatch</a></span><span class="op">(</span><span class="va">tm_out</span>, vars <span class="op">=</span> <span class="va">treat</span> <span class="op">~</span> <span class="va">trainyrbef</span> <span class="op">+</span> <span class="va">hhsize</span>,
               data <span class="op">=</span> <span class="va">jobcorps_female</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##              variable   before_0   before_1    after_0    after_1 before_sd</span>
<span class="co">## trainyrbef trainyrbef 0.01676338 0.01713674 0.01700368 0.01700368 0.1292996</span>
<span class="co">## hhsize         hhsize 4.54094133 4.53802213 4.53844975 4.54373468 2.2087850</span>
<span class="co">##              before_diff before_std_diff  after_diff after_std_diff</span>
<span class="co">## trainyrbef  0.0003733584     0.002887544 0.000000000    0.000000000</span>
<span class="co">## hhsize     -0.0029191932    -0.001321629 0.005284926    0.002392685</span></code></pre>
<p>Calling the <code><a href="../reference/plotDiag.tmatch.html">plotDiag.tmatch()</a></code> function will return a histogram of the number of times each unit is used as a match (<span class="math inline">\(K/L\)</span>) in either the first (mediator) stage or the second (treatment) stage.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Number of times each unit is used as a match in the mediator (first) stage</span>
<span class="fu"><a href="../reference/plotDiag.tmatch.html">plotDiag.tmatch</a></span><span class="op">(</span><span class="va">tm_out</span>, stage <span class="op">=</span> <span class="st">"work2year2q"</span><span class="op">)</span></code></pre></div>
<p><img src="telescope_matching_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Number of times each unit is used as a match in the treatment (second) stage</span>
<span class="fu"><a href="../reference/plotDiag.tmatch.html">plotDiag.tmatch</a></span><span class="op">(</span><span class="va">tm_out</span>, stage <span class="op">=</span> <span class="st">"treat"</span><span class="op">)</span></code></pre></div>
<p><img src="telescope_matching_files/figure-html/unnamed-chunk-7-2.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-AbaImb11">
<p>Abadie, Alberto, and Guido W Imbens. 2011. “Bias-Corrected Matching Estimators for Average Treatment Effects.” <em>Journal of Business &amp; Economic Statistics</em> 29 (1): 1–11.</p>
</div>
<div id="ref-BlaStr21">
<p>Blackwell, Matthew, and Anton Strezhnev. 2021. “Telescope Matching for Reducing Model Dependence in the Estimation of the Effects of Time-Varying Treatments: An Application to Negative Advertising.” <em>Journal of the Royal Statistical Society (Series A)</em>.</p>
</div>
<div id="ref-Hub14">
<p>Huber, Martin. 2014. “Identifying Causal Mechanisms (Primarily) Based on Inverse Probability Weighting.” <em>Journal of Applied Econometrics</em> 29 (6): 920–43.</p>
</div>
<div id="ref-OtsRai17">
<p>Otsu, Taisuke, and Yoshiyasu Rai. 2017. “Bootstrap Inference of Matching Estimators for Average Treatment Effects.” <em>Journal of the American Statistical Association</em> 112 (520): 1720–32.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthew Blackwell, Avidit Acharya, Maya Sen, Shiro Kuriwaki, Jacob Brown, Anton Strezhnev.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

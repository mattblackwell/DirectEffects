<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Difference-in-differences Designs • DirectEffects</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Difference-in-differences Designs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DirectEffects</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/DirectEffects.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/did_cde.html">Difference-in-differences Designs</a></li>
    <li><a class="dropdown-item" href="../articles/sequential_g.html">Sequential g-estimation</a></li>
    <li><a class="dropdown-item" href="../articles/telescope_matching.html">Telescope matching</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mattblackwell/DirectEffects/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Difference-in-differences Designs</h1>
            
            <h4 data-toc-skip class="date">2024-10-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mattblackwell/DirectEffects/blob/master/vignettes/articles/did_cde.Rmd" class="external-link"><code>vignettes/articles/did_cde.Rmd</code></a></small>
      <div class="d-none name"><code>did_cde.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="difference-in-differences-designs">Difference-in-differences Designs<a class="anchor" aria-label="anchor" href="#difference-in-differences-designs"></a>
</h2>
<p>When researchers have pretreatment measurements of the outcome and
the mediator, they can use the difference-in-differences (DID) approach
to estimating controlled direct effects of DID-CDEciteTKTK. This
approach can take full advantage of doubly robust estimation as with
other models.</p>
<p>Generally speaking, the DID approach and the selection-on-observable
approach are very similar, with a few differences. First, the outcome
should represent a difference between the pretreatment and posttreatment
measurements of the outcome. Second, one must specify the name of the
variable measuring the pretreatment values of the mediator since the
estimates will be conditional on this variable. Third, there are two
different quantities of interest in this setting that can be estimated,
depending on what one wants to condition on and what assumptions one
wants to make.</p>
<p>In this article, we demonstrate the estimation of CDEs in the DID
setting using data from the field experiment of BKciteTKTK. This
experiment consisted of one baseline survey (<code>t0</code>) and four
posttreatment surveys (<code>t1</code> through <code>t4</code>). In the
experiment, the authors randomly assigned an door-to-door intervention
to either engage in a conversation promoting transgender rights
(<code>treated == 1</code>) or a control conversation about recycling
(<code>treated == 0</code>). Our goal is to estimate the direct effect
of this treatment fixing values of posttreatment subjective feelings
about transgender people (<code>therm_trans_t2</code>, measured in wave
2). The outcome of interest is support for a transgender
nondiscrimination law (<code>nondiscrim_law_t3</code>, measured in wave
3). Baseline covariates consist of several survey measures (labeled with
<code>t0</code>) and several variables from the matched voter file
(labeled <code>vf</code>). These baseline measures include pretreatment
measurements of the mediator (<code>therm_trans_t0</code>) and the
outcome (<code>nondiscrim_law_t0</code>). For purposes of estimation, we
will use the difference between the pre and posttreatment outcomes
(<code>nondiscrim_law_diff</code>) as the outcome in the models below.
We measure intermediate confounders at from wave 1
(<code>t1</code>).</p>
<p>We can see a brief view of the data below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.5</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.5.1     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">## ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mattblackwell.github.io/DirectEffects/">DirectEffects</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">transphobia</span><span class="op">)</span></span>
<span><span class="va">transphobia</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 501 × 19</span></span></span>
<span><span class="co">##    treated nondiscrim_law_t3 therm_trans_t2 therm_obama_t1 gender_norm_moral_t1</span></span>
<span><span class="co">##      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>       0               1                0             71                   -<span style="color: #BB0000;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>       1               3                2            100                    0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>       0              <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>       1               0                1            100                    0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>       0               1                1              0                   -<span style="color: #BB0000;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>       0               1                1             74                    0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>       1               2.5             <span style="color: #BB0000;">NA</span>            100                    1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>       1              <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>            100                    0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>       1              <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>       1              <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>                   <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 491 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 14 more variables: nondiscrim_law_t0 &lt;dbl&gt;, therm_trans_t0 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   therm_obama_t0 &lt;dbl&gt;, gender_norm_moral_t0 &lt;dbl&gt;, ideology_t0 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   religious_t0 &lt;dbl&gt;, exposure_trans_t0 &lt;dbl&gt;, pid_t0 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   vf_democrat &lt;dbl&gt;, vf_female &lt;dbl&gt;, vf_hispanic &lt;dbl&gt;, vf_black &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   vf_age &lt;dbl&gt;, nondiscrim_law_diff &lt;dbl&gt;</span></span></span></code></pre>
<div class="section level3">
<h3 id="specifying-conditioning-sets">Specifying conditioning sets<a class="anchor" aria-label="anchor" href="#specifying-conditioning-sets"></a>
</h3>
<p>One key step in estimating CDEs is to specify the covariates that we
will condition on for each propensity score and outcome regression. We
can specify in the relevant call to <code>treat_model</code> or
<code>outreg_model</code>, but it is often useful to define the formulas
separately (perhaps to use them in several different models).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Propensity score model for treatment</span></span>
<span><span class="va">ps_t_mod</span> <span class="op">&lt;-</span> <span class="va">treated</span> <span class="op">~</span> <span class="va">therm_trans_t0</span></span>
<span></span>
<span><span class="co">## Propensity score model for treatment</span></span>
<span><span class="va">ps_m_mod</span> <span class="op">&lt;-</span> <span class="va">therm_trans_t2</span> <span class="op">~</span> <span class="va">treated</span> <span class="op">+</span> <span class="va">therm_trans_t0</span> <span class="op">+</span> <span class="va">gender_norm_moral_t0</span> <span class="op">+</span></span>
<span>  <span class="va">therm_obama_t0</span> <span class="op">+</span> <span class="va">vf_democrat</span> <span class="op">+</span> <span class="va">vf_female</span> <span class="op">+</span> <span class="va">vf_black</span> <span class="op">+</span> <span class="va">vf_hispanic</span> <span class="op">+</span></span>
<span>  <span class="va">gender_norm_moral_t1</span> <span class="op">+</span> <span class="va">therm_obama_t1</span> </span>
<span></span>
<span><span class="co">## Outcome models for treatment (short regression)</span></span>
<span><span class="va">or_t_mod</span> <span class="op">&lt;-</span> <span class="va">nondiscrim_law_diff</span> <span class="op">~</span>  <span class="va">treated</span> <span class="op">+</span> <span class="va">therm_trans_t0</span> <span class="op">+</span></span>
<span>  <span class="va">gender_norm_moral_t0</span> <span class="op">+</span> <span class="va">therm_obama_t0</span> <span class="op">+</span> <span class="va">vf_democrat</span> <span class="op">+</span> <span class="va">vf_female</span> <span class="op">+</span></span>
<span>  <span class="va">vf_black</span> <span class="op">+</span> <span class="va">vf_hispanic</span></span>
<span></span>
<span></span>
<span><span class="co">## outcome model for mediator (long regression)</span></span>
<span><span class="va">or_m_mod</span> <span class="op">&lt;-</span> <span class="va">nondiscrim_law_diff</span> <span class="op">~</span> <span class="va">treated</span> <span class="op">+</span> <span class="va">therm_trans_t0</span> <span class="op">+</span> <span class="va">therm_trans_t2</span> <span class="op">+</span></span>
<span>  <span class="va">gender_norm_moral_t0</span> <span class="op">+</span> <span class="va">therm_obama_t0</span> <span class="op">+</span> <span class="va">vf_democrat</span> <span class="op">+</span> <span class="va">vf_female</span> <span class="op">+</span> <span class="va">vf_black</span> <span class="op">+</span></span>
<span>  <span class="va">vf_hispanic</span>  <span class="op">+</span> <span class="va">gender_norm_moral_t1</span> <span class="op">+</span> <span class="va">therm_obama_t1</span></span></code></pre></div>
<p>Here, the propensity score model for treatment only includes the
baseline mediator as treatment is randomly assigned. For the outcome
regression for treatment, we do include baseline covariates for
efficiency reasons. For the mediator models, we include baseline and
intermediate covariates.</p>
</div>
<div class="section level3">
<h3 id="estimating-the-acde">Estimating the ACDE<a class="anchor" aria-label="anchor" href="#estimating-the-acde"></a>
</h3>
<p>We now turn to estimation. The main building block for the DID
approach is the <code><a href="../reference/cde_did_aipw.html">cde_did_aipw()</a></code> function. Like the other
<code><a href="../reference/cde_aipw.html">cde_aipw()</a></code> function, there is the <code>trim</code>
argument that trims the propensity score weights to keep estimates more
stable and the <code>aipw_blip</code> which is a logical that indicates
whether the estimator should use a doubly-robust estimator for the
intermediate “blipped-down” regression functions.</p>
<p>There are several arguments unique to the DID setting. First, the
<code>base_mediator</code> argument specifies what variable in the data
frame will contain the baseline (that is, pretreatment) mediator. The
estimates will be conditional on this variable so it should be discrete.
Second, the <code>on_treated</code> logical argument indicates if the
estimand should further be conditional on being treated and having a
constant value of the mediator over time.</p>
<p>Below we specify the entire chain of estimators, using
<code>multinom</code> for the mediator because it has three levels
(feeling cool, neutral, and warm toward transgender people).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_dr_ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cde_did_aipw.html">cde_did_aipw</a></span><span class="op">(</span>base_mediator <span class="op">=</span> <span class="va">therm_trans_t0</span>, trim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_treatment.html">set_treatment</a></span><span class="op">(</span><span class="va">treated</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/treat_model.html">treat_model</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"logit"</span>, <span class="va">ps_t_mod</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/outreg_model.html">outreg_model</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"lm"</span>, <span class="va">or_t_mod</span>, separate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_treatment.html">set_treatment</a></span><span class="op">(</span><span class="va">therm_trans_t2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/treat_model.html">treat_model</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"multinom"</span>, <span class="va">ps_m_mod</span>, separate <span class="op">=</span> <span class="cn">FALSE</span>, include_past <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/outreg_model.html">outreg_model</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"lm"</span>, <span class="va">or_m_mod</span>, separate <span class="op">=</span> <span class="cn">FALSE</span>, include_past <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">nondiscrim_law_diff</span> <span class="op">~</span> <span class="va">treated</span>, data <span class="op">=</span> <span class="va">transphobia</span>, n_folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>Notice that we have set <code>include_past</code> to
<code>FALSE</code> for the mediator models because we have explicitly
included those covariates in our model specifications. In addition, we
use the difference between posttreatment and pretreatment outcomes as
the depedent variable in this specification.</p>
<p>Using the default <code>on_treated == FALSE</code> implies that we
are estimating what DIDCDEciteTKTK calls the <em>baseline
conditional</em> ACDE or ACDE-BC. We can view the output from these,
with all of the ACDE-BCs using <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>. This also
displays the marginalized ACDE-BC that averages the conditional effects
over the distribution of the baseline mediator.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out_dr_ml</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  did_aipw CDE Estimator</span></span>
<span><span class="co">## ---------------------------</span></span>
<span><span class="co">## Causal variable: treated </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Treatment model: treated ~ therm_trans_t0 </span></span>
<span><span class="co">## Treatment engine: logit </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome model: ~treated + therm_trans_t0 + gender_norm_moral_t0 + therm_obama_t0 +      vf_democrat + vf_female + vf_black + vf_hispanic </span></span>
<span><span class="co">## Outcome engine: lm </span></span>
<span><span class="co">## ---------------------------</span></span>
<span><span class="co">## Causal variable: therm_trans_t2 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Treatment model: therm_trans_t2 ~ treated + therm_trans_t0 + gender_norm_moral_t0 +      therm_obama_t0 + vf_democrat + vf_female + vf_black + vf_hispanic +      gender_norm_moral_t1 + therm_obama_t1 </span></span>
<span><span class="co">## Treatment engine: multinom </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome model: ~treated + therm_trans_t0 + therm_trans_t2 + gender_norm_moral_t0 +      therm_obama_t0 + vf_democrat + vf_female + vf_black + vf_hispanic +      gender_norm_moral_t1 + therm_obama_t1 </span></span>
<span><span class="co">## Outcome engine: lm </span></span>
<span><span class="co">## ---------------------------</span></span>
<span><span class="co">## Cross-fit: TRUE </span></span>
<span><span class="co">## Number of folds: 5 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimated Effects:</span></span>
<span><span class="co">##                             Estimate Std. Error t value Pr(&gt;|t|) CI Lower</span></span>
<span><span class="co">## treated [(1, 0) vs. (0, 0)]  -1.0250     0.7024  -1.459 0.148844  -2.4252</span></span>
<span><span class="co">## treated [(1, 1) vs. (0, 1)]   1.0047     0.3665   2.741 0.006936   0.2799</span></span>
<span><span class="co">## treated [(1, 2) vs. (0, 2)]   0.3450     0.2606   1.324 0.187467  -0.1697</span></span>
<span><span class="co">## treated [(1, *) vs. (0, *)]   0.2963     0.2561   1.157 0.247929  -0.2072</span></span>
<span><span class="co">##                             CI Upper  DF</span></span>
<span><span class="co">## treated [(1, 0) vs. (0, 0)]   0.3752  72</span></span>
<span><span class="co">## treated [(1, 1) vs. (0, 1)]   1.7294 138</span></span>
<span><span class="co">## treated [(1, 2) vs. (0, 2)]   0.8596 159</span></span>
<span><span class="co">## treated [(1, *) vs. (0, *)]   0.7999 369</span></span></code></pre>
<p>Here we can see that there is a statistically significant ACDE-BC for
the neutral group (m = 1), but not for the cool or warm groups. One can
also use the <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code> function from the
<strong>broom</strong> package to easily extract information:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">out_dr_ml</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                                    term   estimate std.error statistic</span></span>
<span><span class="co">## treated_1_0 treated [(1, 0) vs. (0, 0)] -1.0249682 0.7023920 -1.459254</span></span>
<span><span class="co">## treated_1_1 treated [(1, 1) vs. (0, 1)]  1.0046603 0.3665254  2.741039</span></span>
<span><span class="co">## treated_1_2 treated [(1, 2) vs. (0, 2)]  0.3449523 0.2605758  1.323808</span></span>
<span><span class="co">## treated_1_* treated [(1, *) vs. (0, *)]  0.2963301 0.2560696  1.157225</span></span>
<span><span class="co">##                p.value   conf.low conf.high  df</span></span>
<span><span class="co">## treated_1_0 0.14884448 -2.4251610 0.3752246  72</span></span>
<span><span class="co">## treated_1_1 0.00693566  0.2799283 1.7293923 138</span></span>
<span><span class="co">## treated_1_2 0.18746696 -0.1696839 0.8595885 159</span></span>
<span><span class="co">## treated_1_* 0.24792906 -0.2072087 0.7998689 369</span></span></code></pre>
<p>This allows for easy plotting of the results using
<strong>ggpplot2</strong>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">out_dr_ml</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">term</span>, y <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_pointrange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">conf.low</span>, ymax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="did_cde_files/figure-html/unnamed-chunk-6-1.png" alt="Estimated ACDEs from a DID analysis" width="700"></p>
<p>Setting <code>on_treated</code> to <code>TRUE</code>, on the other
hand, estimates the path-conditional ACDE or ACDE-PC.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_dr_ml_pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cde_did_aipw.html">cde_did_aipw</a></span><span class="op">(</span>base_mediator <span class="op">=</span> <span class="va">therm_trans_t0</span>, on_treated <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                             trim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.99</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_treatment.html">set_treatment</a></span><span class="op">(</span><span class="va">treated</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/treat_model.html">treat_model</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"logit"</span>, <span class="va">ps_t_mod</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/outreg_model.html">outreg_model</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"lm"</span>, <span class="va">or_t_mod</span>, separate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_treatment.html">set_treatment</a></span><span class="op">(</span><span class="va">therm_trans_t2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/treat_model.html">treat_model</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"multinom"</span>, <span class="va">ps_m_mod</span>, separate <span class="op">=</span> <span class="cn">FALSE</span>, include_past <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/outreg_model.html">outreg_model</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"lm"</span>, <span class="va">or_m_mod</span>, separate <span class="op">=</span> <span class="cn">FALSE</span>, include_past <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/estimate.html">estimate</a></span><span class="op">(</span><span class="va">nondiscrim_law_diff</span> <span class="op">~</span> <span class="va">treated</span>, data <span class="op">=</span> <span class="va">transphobia</span>, n_folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out_dr_ml_pc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  did_aipw CDE Estimator</span></span>
<span><span class="co">## ---------------------------</span></span>
<span><span class="co">## Causal variable: treated </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Treatment model: treated ~ therm_trans_t0 </span></span>
<span><span class="co">## Treatment engine: logit </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome model: ~treated + therm_trans_t0 + gender_norm_moral_t0 + therm_obama_t0 +      vf_democrat + vf_female + vf_black + vf_hispanic </span></span>
<span><span class="co">## Outcome engine: lm </span></span>
<span><span class="co">## ---------------------------</span></span>
<span><span class="co">## Causal variable: therm_trans_t2 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Treatment model: therm_trans_t2 ~ treated + therm_trans_t0 + gender_norm_moral_t0 +      therm_obama_t0 + vf_democrat + vf_female + vf_black + vf_hispanic +      gender_norm_moral_t1 + therm_obama_t1 </span></span>
<span><span class="co">## Treatment engine: multinom </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome model: ~treated + therm_trans_t0 + therm_trans_t2 + gender_norm_moral_t0 +      therm_obama_t0 + vf_democrat + vf_female + vf_black + vf_hispanic +      gender_norm_moral_t1 + therm_obama_t1 </span></span>
<span><span class="co">## Outcome engine: lm </span></span>
<span><span class="co">## ---------------------------</span></span>
<span><span class="co">## Cross-fit: TRUE </span></span>
<span><span class="co">## Number of folds: 5 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimated Effects:</span></span>
<span><span class="co">##                             Estimate Std. Error t value Pr(&gt;|t|) CI Lower</span></span>
<span><span class="co">## treated [(1, 0) vs. (0, 0)]  -0.1465     0.5205 -0.2815  0.77912 -1.18413</span></span>
<span><span class="co">## treated [(1, 1) vs. (0, 1)]   0.6810     0.3125  2.1793  0.03101  0.06311</span></span>
<span><span class="co">## treated [(1, 2) vs. (0, 2)]   0.3436     0.1827  1.8810  0.06180 -0.01718</span></span>
<span><span class="co">## treated [(1, *) vs. (0, *)]   0.3724     0.2016  1.8474  0.06549 -0.02399</span></span>
<span><span class="co">##                             CI Upper  DF</span></span>
<span><span class="co">## treated [(1, 0) vs. (0, 0)]   0.8911  72</span></span>
<span><span class="co">## treated [(1, 1) vs. (0, 1)]   1.2990 138</span></span>
<span><span class="co">## treated [(1, 2) vs. (0, 2)]   0.7044 159</span></span>
<span><span class="co">## treated [(1, *) vs. (0, *)]   0.7688 369</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Blackwell, Avidit Acharya, Maya Sen, Shiro Kuriwaki, Jacob Brown, Anton Strezhnev.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
